<!DOCTYPE html>
<html>
  <head>
    <link href="./bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="./select2/select2.css" rel="stylesheet">
    <link href="./css/config.css" rel="stylesheet">
  </head>
  <body>
    <!-- if this has been filled in before, remove next class and "configured"-->
    <div class="nav-steps">
      <a class="step_container next active" href="submittedFiles.html"><span class="badge badge-info">1</span> Submitted Files</a>
      <span class="step_container next"><span class="badge">2</span> Supplied Files</span>
      <span class="step_container next"><span class="badge">3</span> Compiler Options</span>
      <span class="step_container next"><span class="badge">4</span> Tests</span>
      <span class="step_container"><span class="badge">5</span> Sharing</span>
    </div>

    <div class="step-container">
      <form class="form-horizontal" action="suppliedFiles.html">
        <legend>Submitted Files</legend>
        <div class="control-group">
          <label class="control-label" for="fileSubmissionMethod">What can be submitted?</label>
          <div class="controls" id="fileSubmissionOptions">
            <label class="radio">
              <input id="embedOption" type="radio" value="embed" name="fileSubmissionMethod"> A single file is submitted via an embedded editor
            </label>
            <label class="radio">
              <input id="uploadOption" type="radio" value="upload" name="fileSubmissionMethod"> Multiple files can be uploaded
            </label>
          </div>
        </div>

        <!-- get "hide" class from server -->
        <div class="control-group hide" id="requiredFilesContainer">
          <label class="control-label" for="requiredFileNames">Required Files:</label>
          <div class="controls">
            <!-- get value from server -->
            <input type="text" name="requiredFileNames" id="requiredFileNames" placeholder="File Names">
          </div>
        </div>

        <!-- get "hide" class from server -->
        <div class="control-group" id="embeddedFilenameContainer">
          <label class="control-label" for="embeddedFilename">File Name:</label>
          <div class="controls">
            <!-- get value from server -->
            <input type="text" name="embeddedFilename" value="solution.c" placeholder="File Name">
          </div>
        </div>

        <div class="control-group" id="preprocessingContainer">

          <label class="control-label" for="preprocessing">Pre-processing:</label>
          <div class="controls">

            <p>
              Submitted files will be modified before compilation by running the following search/replace combinations:
            </p>

            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>Name</th>
                  <th class="filesColumn">Files</th>
                  <th>Search</th>
                  <th>Replace</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Replace Main</td>
                  <td class="filesColumn">
                    <ul class="unstyled file-list">
                      <li>foo.c</li>
                    </ul>
                  </td>
                  <td>
                    <code>(int|void)\s+main\s*\(</code>
                  </td>
                  <td><code>int main(</code></td>
                  <td>
                    <a href="#"><i class="icon-arrow-up"></i></a>
                    <a href="#"><i class="icon-arrow-down"></i></a>
                    <a href="#"><i class="icon-edit"></i></a>
                    <a href="#"><i class="icon-trash"></i></a>
                  </td>
                </tr>
              </tbody>
            </table>

            <a href="#" id="newPreprocessorButton" class="btn btn-success"><i class="icon-plus icon-white"></i> Add</a>
          </div>
        </div>

        <div class="form-actions">
          <!-- if it's been filled in before, make this say "Save" -->
          <button type="submit" class="btn btn-primary pull-right">Next &rarr;</button>
        </div>
      </form>
    </div>

    <div class="modal hide fade" id="preprocessingModal">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Pre-processing Step</h3>
      </div>
      <div class="modal-body">
        <form class="form-horizontal">
          <div class="control-group">
            <label class="control-label" for="newPreprocessorName">Name:</label>
            <div class="controls">
              <input type="text" name="newPreprocessorName" placeholder="Name">
            </div>
          </div>

          <div class="control-group hide" id="modalFilesContainer">
            <label class="control-label" for="newPreprocessorFiles">Files:</label>
            <div class="controls">
              <input id="newPreprocessorFiles" type="text" name="newPreprocessorFiles">
            </div>
          </div>

          <div class="control-group">
            <label class="control-label" for="newPreprocessorSearch">Search:</label>
            <div class="controls">
              <input type="text" name="newPreprocessorSearch" placeholder="Search RegEx">
            </div>
          </div>

          <div class="control-group">
            <label class="control-label" for="newPreprocessorReplace">Replace:</label>
            <div class="controls">
              <input type="text" name="newPreprocessorReplace" placeholder="Replacement">
            </div>
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Close</a>
        <a href="#" class="btn btn-success">Save</a>
      </div>
    </div>

    <script type="text/javascript" src="./jquery.js"></script>
    <script type="text/javascript" src="./bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./formToJSON.js"></script>
    <script type="text/javascript" src="./select2/select2.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        $('#requiredFileNames').select2({
          width: '100%',
          minimumInputLength: 2,
          tokenSeparators: [",", " "],
          tags: []
        });

        $('#newPreprocessorFiles').select2({
          minimumInputLength: 2,
          tokenSeparators: [",", " "],
          tags: ['foo.c', 'bah.h'], // TODO: function that extracts this from #requiredFileNames
          width: 'element'
        });

        $('#newPreprocessorButton').click(function(){
          $('#preprocessingModal').modal('show');
          $('#preprocessingModal form').reset();
          return false;
        });

        $('#fileSubmissionOptions input:radio').change(function() {
          var selectedOption = $('#fileSubmissionOptions input:radio:checked').val();
          if (selectedOption === 'embed') {
            $('#requiredFileNames').select2('disable');
            $('#requiredFilesContainer').hide();
            $('#embeddedFilenameContainer').show();
            $('#modalFilesContainer').hide();
            $('.filesColumn').hide();
          } else if (selectedOption === 'upload') {
            $('#requiredFileNames').select2('enable');
            $('#requiredFilesContainer').show();
            $('#embeddedFilenameContainer').hide();
            $('#modalFilesContainer').show();
            $('.filesColumn').show();
          }
        });


        if (true) {
          $('#embedOption').prop('checked', true);
        } else {
          $('#uploadOption').prop('checked', true);
        }
        $('#fileSubmissionOptions input:radio').change();

      });
    </script>
  </body>
</html>